<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <title>Manage Photos</title>
        <link rel="stylesheet" href="css/app.css">
        <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css">
    </head>
    <body>
        <h1 class="title">Manage Photos</h1>

        <h3 class="title">Rename photos of a folder</h3>
        <form class="form" action="#">
            <input id="photos-folder-txt" class="input-size-m" type="text" name="photos_folder" placeholder="Photos folder..." />
            <label class="custom-file-upload">
                <input id="photos-folder" type="file" webkitdirectory />
                <i class="fa fa-folder-open"></i> Select folder
            </label>
            <br /><br />
            <button id="show-files-btn" class="btn">Show files</button>
            <button id="rename-btn" class="btn">Rename!</button>
        </form>

        <footer>
            <!-- All of the Node.js APIs are available in this renderer process. -->
            <p>
                Node.js <script>document.write(process.versions.node)</script> |
                Chromium <script>document.write(process.versions.chrome)</script> |
                Electron <script>document.write(process.versions.electron)</script>
            </p>
            <p>&copy; 2015 - csd</p>
        </footer>
  </body>
  <script>window.$ = window.jQuery = require('jquery');</script>
  <script>

      let $pf = $('#photos-folder');
      let $pft = $('#photos-folder-txt');
      $pf.on('change', (e) => {
          selectedFolder = getFolder($pf);
          $pft.val(selectedFolder);
      });

      $('#show-files-btn').on('click', () => {
          onSelectedFolder($pft.val());
      });
      $('#rename-btn').on('click', () => {
          onSelectedFolder($pft.val(), true);
      });

      function onSelectedFolder(selectedFolder, doRename = false)
      {
          // send event to main window
          if(selectedFolder){
              const {ipcRenderer} = require('electron');
              let params = {'folder': selectedFolder, 'doRename': doRename};
              console.log('send event to main window', params);
              ipcRenderer.send('ri-folder-selected', params);
          }
      }

      /**
       * Get selected folder
       * @param $folderInput
       * @returns promise
       */
      function getFolder($folderInput)
      {
          let pfFiles = $folderInput.prop('files');
          if(pfFiles.length > 0) {
              return pfFiles[0].path;
          }
          return null;
      }

  </script>
</html>
